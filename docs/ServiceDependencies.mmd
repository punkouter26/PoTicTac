%%{ init: { 'theme': 'dark', 'themeVariables': { 'primaryColor': '#00d9ff' } } }%%

%% PoTicTac Service Dependencies Diagram
%% Shows external touchpoints and integrations

graph TB
    subgraph Application["ğŸ¯ PoTicTac Application"]
        WebApp["ğŸŒ React Web App<br/>(Po.TicTac.Web)"]
        API["âš™ï¸ .NET 10 API<br/>(Po.TicTac.Api)"]
    end

    subgraph AzureDataServices["ğŸ’¾ Azure Data Services"]
        TableStorage["ğŸ“Š Azure Table Storage<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Player statistics<br/>â€¢ Leaderboard data<br/>â€¢ stpotictac account<br/>â€¢ Serverless, pay-per-use"]
    end

    subgraph AzureSecurityServices["ğŸ” Azure Security Services"]
        KeyVault["ğŸ”‘ Azure Key Vault<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Connection strings<br/>â€¢ API keys<br/>â€¢ Managed by PoShared<br/>â€¢ Accessed via Managed Identity"]
        
        ManagedIdentity["ğŸ†” Managed Identity<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ id-potictac<br/>â€¢ No stored credentials<br/>â€¢ Automatic rotation"]
    end

    subgraph AzureHostingServices["ğŸš€ Azure Hosting Services"]
        ContainerApps["ğŸ“¦ Container Apps<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ cae-poshared environment<br/>â€¢ Auto-scaling 0-10<br/>â€¢ Managed Kubernetes<br/>â€¢ HTTPS with custom domain"]
        
        ContainerRegistry["ğŸ³ Container Registry<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ acrposhared<br/>â€¢ Docker images<br/>â€¢ Vulnerability scanning"]
    end

    subgraph AzureMonitoringServices["ğŸ“ˆ Azure Monitoring Services"]
        AppInsights["ğŸ“Š Application Insights<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Request tracing<br/>â€¢ Performance metrics<br/>â€¢ Error tracking<br/>â€¢ Live metrics stream"]
        
        LogAnalytics["ğŸ“ Log Analytics Workspace<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ law-poshared<br/>â€¢ Kusto queries<br/>â€¢ Log retention 30 days"]
    end

    subgraph DevOpsPlatform["ğŸ”„ DevOps Platform"]
        GitHub["ğŸ™ GitHub<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Source repository<br/>â€¢ Actions CI/CD<br/>â€¢ OIDC authentication<br/>â€¢ Issue tracking"]
    end

    subgraph CDN["ğŸŒ Content Delivery (Planned)"]
        AzureCDN["ğŸ“¡ Azure CDN<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Static asset caching<br/>â€¢ Global edge locations<br/>â€¢ HTTPS termination"]
    end

    subgraph FutureDependencies["ğŸ”® Future Dependencies (Planned)"]
        SignalR["ğŸ“¡ Azure SignalR<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Real-time multiplayer<br/>â€¢ WebSocket connections"]
        
        EntraID["ğŸ”’ Azure Entra ID<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ OAuth authentication<br/>â€¢ User profiles"]
        
        Redis["âš¡ Azure Cache for Redis<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Distributed caching<br/>â€¢ Session state"]
    end

    %% Current Dependencies
    WebApp -->|"REST API<br/>JSON/HTTPS"| API
    API -->|"Table SDK<br/>Managed Identity"| TableStorage
    API -->|"Configuration<br/>Managed Identity"| KeyVault
    API -->|"Identity"| ManagedIdentity
    API -->|"Telemetry<br/>OpenTelemetry"| AppInsights
    AppInsights -->|"Logs"| LogAnalytics
    
    ContainerRegistry -->|"Images"| ContainerApps
    ContainerApps -->|"Hosts"| API
    
    GitHub -->|"CI/CD<br/>OIDC"| ContainerApps
    GitHub -->|"Pushes to"| ContainerRegistry

    %% Planned Dependencies (dashed)
    WebApp -.->|"Static assets<br/>(planned)"| AzureCDN
    API -.->|"Real-time<br/>(planned)"| SignalR
    WebApp -.->|"SignalR<br/>(planned)"| SignalR
    API -.->|"Auth<br/>(planned)"| EntraID
    API -.->|"Distributed cache<br/>(planned)"| Redis

    %% Styling
    classDef app fill:#1a1a2e,stroke:#00d9ff,stroke-width:2px,color:#fff
    classDef data fill:#16213e,stroke:#39ff14,stroke-width:2px,color:#fff
    classDef security fill:#0f3460,stroke:#ffd93d,stroke-width:2px,color:#fff
    classDef hosting fill:#2d2d44,stroke:#ff6b6b,stroke-width:2px,color:#fff
    classDef monitoring fill:#1e3a5f,stroke:#00d9ff,stroke-width:2px,color:#fff
    classDef devops fill:#3d1a4a,stroke:#e040fb,stroke-width:2px,color:#fff
    classDef future fill:#333,stroke:#666,stroke-width:1px,stroke-dasharray:5 5,color:#999

    class WebApp,API app
    class TableStorage data
    class KeyVault,ManagedIdentity security
    class ContainerApps,ContainerRegistry hosting
    class AppInsights,LogAnalytics monitoring
    class GitHub devops
    class AzureCDN,SignalR,EntraID,Redis future
