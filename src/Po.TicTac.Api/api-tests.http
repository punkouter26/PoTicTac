### PoTicTac API Verification Tests
### Use REST Client VS Code Extension or similar HTTP client
### All tests include inline assertions

@hostname = localhost
@port = 5000
@host = {{hostname}}:{{port}}
@contentType = application/json

###############################################
# Health Check Endpoint
###############################################

### Test 1: Health Check - Should Return 200 OK
# @name healthCheck
GET http://{{host}}/api/health HTTP/1.1

###
# @assert {{healthCheck.response.status}} == 200
# @assert {{healthCheck.response.headers.content-type}} includes application/json
# @assert {{healthCheck.response.body.status}} == "Healthy"
# @assert {{healthCheck.response.body.totalDuration}} > 0

###############################################
# Statistics Endpoints
###############################################

### Test 2: Get All Player Statistics - Should Return 200 OK with Array
# @name getAllStats
GET http://{{host}}/api/statistics HTTP/1.1

###
# @assert {{getAllStats.response.status}} == 200
# @assert {{getAllStats.response.headers.content-type}} includes application/json
# @assert {{getAllStats.response.body}} isArray

### Test 3: Get Leaderboard - Should Return 200 OK with Sorted Players
# @name getLeaderboard
GET http://{{host}}/api/statistics/leaderboard?limit=10 HTTP/1.1

###
# @assert {{getLeaderboard.response.status}} == 200
# @assert {{getLeaderboard.response.headers.content-type}} includes application/json
# @assert {{getLeaderboard.response.body}} isArray

###############################################
# Player Statistics Endpoints
###############################################

@testPlayer = test-player-{{$randomInt}}

### Test 4: Save Player Stats - Should Return 204 No Content
# @name savePlayerStats
PUT http://{{host}}/api/players/{{testPlayer}}/stats HTTP/1.1
Content-Type: {{contentType}}

{
  "totalWins": 1,
  "totalLosses": 0,
  "totalDraws": 0,
  "totalGames": 1,
  "overallWinRate": 1.0,
  "easy": {
    "wins": 1,
    "losses": 0,
    "draws": 0,
    "totalGames": 1,
    "winStreak": 1,
    "currentStreak": 1,
    "averageMovesPerGame": 4,
    "totalMoves": 4,
    "winRate": 1.0
  },
  "medium": {},
  "hard": {}
}

###
# @assert {{savePlayerStats.response.status}} == 204

### Test 5: Get Player Stats - Should Return 200 OK When Data Exists
# @name getPlayerStats
GET http://{{host}}/api/players/{{testPlayer}}/stats HTTP/1.1

###
# @assert {{getPlayerStats.response.status}} == 200
# @assert {{getPlayerStats.response.headers.content-type}} includes application/json
# @assert {{getPlayerStats.response.body.name}} == "{{testPlayer}}"
# @assert {{getPlayerStats.response.body.stats.totalGames}} == 1

### Test 6: Get Missing Player Stats - Should Return 404 Not Found
# @name getMissingPlayerStats
GET http://{{host}}/api/players/non-existent-player-{{$randomInt}}/stats HTTP/1.1

###
# @assert {{getMissingPlayerStats.response.status}} == 404

### Test 10: Delete Player - Should Return 204 No Content
# @name deletePlayer
DELETE http://{{host}}/api/players/{{newPlayerId}} HTTP/1.1

###
# @assert {{deletePlayer.response.status}} == 204

### Test 11: Verify Delete - Should Return 404 Not Found
# @name verifyDelete
GET http://{{host}}/api/players/{{newPlayerId}} HTTP/1.1

###
# @assert {{verifyDelete.response.status}} == 404

###############################################
# Error Handling Tests
###############################################

### Test 12: Invalid Player ID - Should Return 404
# @name invalidPlayerId
GET http://{{host}}/api/players/non-existent-player-12345 HTTP/1.1

###
# @assert {{invalidPlayerId.response.status}} == 404

###############################################
# Performance Tests
###############################################

### Test 15: Health Check Performance - Should Respond Quickly
# @name healthPerformance
GET http://{{host}}/api/health HTTP/1.1

###
# @assert {{healthPerformance.response.status}} == 200
# @assert {{healthPerformance.response.time}} < 1000

### Test 16: Get All Statistics Performance - Should Respond Quickly
# @name getAllStatsPerformance
GET http://{{host}}/api/statistics HTTP/1.1

###
# @assert {{getAllStatsPerformance.response.status}} == 200
# @assert {{getAllStatsPerformance.response.time}} < 2000

###############################################
# CORS and Security Headers Tests
###############################################

### Test 17: OPTIONS Request - Should Return Allowed Methods
# @name optionsRequest
OPTIONS http://{{host}}/api/players/test-player-{{$randomInt}}/stats HTTP/1.1

###
# @assert {{optionsRequest.response.status}} in [200, 204]

### Test 18: Security Headers - Should Include Security Headers
# @name securityHeaders
GET http://{{host}}/api/health HTTP/1.1

###
# @assert {{securityHeaders.response.headers.x-content-type-options}} != null

###############################################
# Batch Operations Test
###############################################

### Test 19: Leaderboard Contains Data
# @name leaderboardCheck
GET http://{{host}}/api/statistics/leaderboard HTTP/1.1

###
# @assert {{leaderboardCheck.response.status}} == 200
# @assert {{leaderboardCheck.response.body.length}} >= 0
