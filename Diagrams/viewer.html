<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PoTicTac Diagram Viewer & Exporter</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose'
        });
    </script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #32cd32;
            padding-bottom: 10px;
        }
        .diagram-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .diagram-section h2 {
            color: #1e90ff;
            margin-top: 0;
        }
        .diagram-container {
            margin: 20px 0;
            padding: 20px;
            background: #fafafa;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow-x: auto;
        }
        .export-btn {
            background: #32cd32;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px 10px 0;
        }
        .export-btn:hover {
            background: #28a428;
        }
        .instructions {
            background: #e7f3ff;
            border-left: 4px solid #1e90ff;
            padding: 15px;
            margin: 20px 0;
        }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffa500;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>üéÆ PoTicTac Architecture Diagrams</h1>
    
    <div class="instructions">
        <h3>üìã Instructions for Exporting SVG Files:</h3>
        <ol>
            <li>Open this file in a web browser (Chrome, Firefox, Edge)</li>
            <li>Wait for all diagrams to render (may take 5-10 seconds)</li>
            <li>Right-click on any diagram and select "Save Image As..." or "Copy Image"</li>
            <li>Save as SVG format (browser dependent)</li>
            <li><strong>Alternative:</strong> Use the "Download SVG" button below each diagram</li>
        </ol>
    </div>

    <div class="warning">
        <strong>‚ö†Ô∏è Note:</strong> If diagrams don't render, you may need an internet connection to load the Mermaid library from CDN. 
        Alternatively, use VS Code with the Mermaid Preview extension to view .mmd files directly.
    </div>

    <!-- Diagram 1: Project Dependency -->
    <div class="diagram-section">
        <h2>1. Project Dependency Diagram</h2>
        <p><strong>Purpose:</strong> Visualizes how .NET projects and services are interconnected</p>
        <button class="export-btn" onclick="downloadSVG('diagram1', 'ProjectDependency.svg')">‚¨áÔ∏è Download SVG</button>
        <div class="diagram-container">
            <div class="mermaid" id="diagram1">
graph TD
    subgraph "Solution: PoTicTac"
        Client["PoTicTac.Client<br/>(Blazor WebAssembly)"]
        Server["PoTicTacServer<br/>(ASP.NET Core Web API)"]
        UnitTests["PoTicTac.UnitTests<br/>(xUnit Test Project)"]
        IntegrationTests["PoTicTac.IntegrationTests<br/>(xUnit Test Project)"]
    end
    
    subgraph "External Services"
        AzureStorage["Azure Table Storage<br/>(PlayerStats table)"]
        AppInsights["Application Insights<br/>(Telemetry & Logging)"]
        SignalRHub["SignalR Hub<br/>(Real-time Communication)"]
    end
    
    Server -->|Hosts & Serves| Client
    UnitTests -->|Tests| Client
    UnitTests -->|Tests| Server
    IntegrationTests -->|Tests| Server
    
    Server -->|Reads/Writes| AzureStorage
    Server -->|Logs to| AppInsights
    Server -->|Provides| SignalRHub
    Client -->|Connects to| SignalRHub
    Client -->|API Calls| Server
    IntegrationTests -->|Validates| AzureStorage
    IntegrationTests -->|Tests API| Server
    
    classDef clientStyle fill:#1e90ff,stroke:#000,stroke-width:2px,color:#fff
    classDef serverStyle fill:#32cd32,stroke:#000,stroke-width:2px,color:#000
    classDef testStyle fill:#ffa500,stroke:#000,stroke-width:2px,color:#000
    classDef azureStyle fill:#00d4ff,stroke:#000,stroke-width:2px,color:#000
    
    class Client clientStyle
    class Server serverStyle
    class UnitTests,IntegrationTests testStyle
    class AzureStorage,AppInsights,SignalRHub azureStyle
            </div>
        </div>
    </div>

    <!-- Diagram 2: Class Diagram -->
    <div class="diagram-section">
        <h2>2. Class Diagram - Domain Entities</h2>
        <p><strong>Purpose:</strong> Models core business objects and their relationships</p>
        <button class="export-btn" onclick="downloadSVG('diagram2', 'ClassDiagram.svg')">‚¨áÔ∏è Download SVG</button>
        <div class="diagram-container">
            <div class="mermaid" id="diagram2">
classDiagram
    class GameBoardState {
        +PlayerType[,] Board
        +PlayerType CurrentPlayer
        +GameStatus GameStatus
        +PlayerType? Winner
        +Player[] Players
        +List~Move~ MoveHistory
        +const int BoardSize = 6
    }
    
    class Player {
        +string Id
        +string Name
        +PlayerType Type
        +PlayerType Symbol
        +AIConfig? AiConfig
        +PlayerStats Stats
    }
    
    class Move {
        +PlayerType Player
        +int[] Position
        +long Timestamp
    }
    
    class PlayerStats {
        +int TotalGames
        +int Wins
        +int Losses
        +int Draws
        +double WinRate
        +int WinStreak
        +double AverageMovesPerGame
    }
    
    class AIConfig {
        +Difficulty Difficulty
        +int? ThinkingTime
    }
    
    class GameStatus {
        <<enumeration>>
        Playing
        Won
        Draw
    }
    
    class PlayerType {
        <<enumeration>>
        X
        O
        None
    }
    
    class Difficulty {
        <<enumeration>>
        Easy
        Medium
        Hard
    }
    
    GameBoardState "1" --> "2" Player : contains
    GameBoardState "1" --> "*" Move : tracks
    GameBoardState --> GameStatus : uses
    GameBoardState --> PlayerType : uses
    Player "1" --> "1" PlayerStats : has
    Player --> PlayerType : uses
    Player "1" --> "0..1" AIConfig : may have
    AIConfig --> Difficulty : uses
            </div>
        </div>
    </div>

    <!-- Diagram 3: Sequence Diagram -->
    <div class="diagram-section">
        <h2>3. Sequence Diagram - API Call Flow</h2>
        <p><strong>Purpose:</strong> Traces request flow for game moves and statistics</p>
        <button class="export-btn" onclick="downloadSVG('diagram3', 'SequenceDiagram.svg')">‚¨áÔ∏è Download SVG</button>
        <div class="diagram-container">
            <div class="mermaid" id="diagram3">
sequenceDiagram
    actor User
    participant UI as Blazor UI
    participant GameLogic as GameLogicService
    participant AILogic as AILogicService
    participant Stats as StatisticsService
    participant API as API Controller
    participant Storage as Azure Storage
    
    User->>UI: Click cell (row, col)
    UI->>GameLogic: MakeMove(row, col)
    GameLogic->>GameLogic: ValidateMove()
    GameLogic->>GameLogic: UpdateBoard()
    GameLogic->>GameLogic: CheckWinner()
    GameLogic-->>UI: Return GameState
    UI-->>User: Display move
    
    alt Game continues
        UI->>AILogic: GetAIMove(gameState)
        AILogic->>AILogic: Calculate move
        AILogic-->>UI: Return AI position
        UI->>GameLogic: MakeMove(AI position)
        GameLogic-->>UI: Return GameState
        UI-->>User: Display AI move
    end
    
    alt Game Over
        UI->>Stats: UpdatePlayerStats()
        Stats->>API: POST /api/statistics
        API->>Storage: UpsertEntity()
        Storage-->>API: Success
        API-->>Stats: PlayerStats
        Stats-->>UI: Success
        UI-->>User: Show result
    end
            </div>
        </div>
    </div>

    <!-- Diagram 4: Use Case Flowchart -->
    <div class="diagram-section">
        <h2>4. Use Case Flowchart - Game Flow</h2>
        <p><strong>Purpose:</strong> Complete user journey from start to game completion</p>
        <button class="export-btn" onclick="downloadSVG('diagram4', 'UseCaseFlowchart.svg')">‚¨áÔ∏è Download SVG</button>
        <div class="diagram-container">
            <div class="mermaid" id="diagram4">
flowchart TD
    Start([User Opens App]) --> EnterName[Enter Player Name]
    EnterName --> SelectMode{Select Game Mode}
    SelectMode -->|Single Player| SelectDifficulty[Select AI Difficulty]
    SelectMode -->|Multiplayer| JoinLobby[Join Lobby]
    SelectDifficulty --> StartGame[Start Game]
    JoinLobby --> StartGame
    StartGame --> PlayerTurn{Player Turn?}
    PlayerTurn -->|Yes| SelectCell[Click Cell]
    PlayerTurn -->|No| AITurn[AI Move]
    SelectCell --> ValidateMove{Valid?}
    ValidateMove -->|No| PlayerTurn
    ValidateMove -->|Yes| UpdateBoard[Update Board]
    AITurn --> UpdateBoard
    UpdateBoard --> CheckWinner{Game Over?}
    CheckWinner -->|No| PlayerTurn
    CheckWinner -->|Win| PlayerWins[Player Wins!]
    CheckWinner -->|Loss| PlayerLoses[AI/Opponent Wins]
    CheckWinner -->|Draw| DrawGame[Draw Game]
    PlayerWins --> UpdateStats[Update Statistics]
    PlayerLoses --> UpdateStats
    DrawGame --> UpdateStats
    UpdateStats --> PlayAgain{Play Again?}
    PlayAgain -->|Yes| StartGame
    PlayAgain -->|No| End([End])
            </div>
        </div>
    </div>

    <!-- Diagram 5: Component Hierarchy -->
    <div class="diagram-section">
        <h2>5. Component Hierarchy - Blazor Components</h2>
        <p><strong>Purpose:</strong> Tree view of Blazor component nesting</p>
        <button class="export-btn" onclick="downloadSVG('diagram5', 'ComponentHierarchy.svg')">‚¨áÔ∏è Download SVG</button>
        <div class="diagram-container">
            <div class="mermaid" id="diagram5">
graph TD
    App["App.razor"] --> Router["Router"]
    Router --> MainLayout["MainLayout.razor"]
    MainLayout --> NavMenu["NavMenu.razor"]
    MainLayout --> HomePage["Home.razor (/)"]
    MainLayout --> StatsPage["Stats.razor (/stats)"]
    MainLayout --> DiagPage["Diag.razor (/diag)"]
    HomePage --> GameBoard["GameBoard.razor"]
    HomePage --> DifficultySelector["DifficultySelector.razor"]
    StatsPage --> RadzenCard["RadzenCard"]
    StatsPage --> RadzenDataGrid["RadzenDataGrid"]
    
    classDef rootStyle fill:#1e90ff,stroke:#000,stroke-width:2px,color:#fff
    classDef layoutStyle fill:#32cd32,stroke:#000,stroke-width:2px,color:#000
    classDef pageStyle fill:#ffa500,stroke:#000,stroke-width:2px,color:#000
    classDef componentStyle fill:#9370db,stroke:#000,stroke-width:2px,color:#fff
    
    class App,Router rootStyle
    class MainLayout,NavMenu layoutStyle
    class HomePage,StatsPage,DiagPage pageStyle
    class GameBoard,DifficultySelector,RadzenCard,RadzenDataGrid componentStyle
            </div>
        </div>
    </div>

    <script>
        // Function to download SVG
        function downloadSVG(diagramId, filename) {
            try {
                // Find the SVG element inside the diagram container
                const container = document.getElementById(diagramId);
                const svg = container.querySelector('svg');
                
                if (!svg) {
                    alert('Diagram not yet rendered. Please wait a moment and try again.');
                    return;
                }
                
                // Clone the SVG to avoid modifying the displayed version
                const svgClone = svg.cloneNode(true);
                
                // Set proper dimensions if needed
                if (!svgClone.getAttribute('width')) {
                    svgClone.setAttribute('width', svg.getBoundingClientRect().width);
                }
                if (!svgClone.getAttribute('height')) {
                    svgClone.setAttribute('height', svg.getBoundingClientRect().height);
                }
                
                // Serialize the SVG to string
                const serializer = new XMLSerializer();
                let svgString = serializer.serializeToString(svgClone);
                
                // Add XML declaration
                svgString = '<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n' + svgString;
                
                // Create a blob and download
                const blob = new Blob([svgString], { type: 'image/svg+xml;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                console.log('Downloaded: ' + filename);
            } catch (error) {
                console.error('Error downloading SVG:', error);
                alert('Error downloading SVG. Please try right-clicking the diagram and "Save Image As..."');
            }
        }

        // Show a message when all diagrams are loaded
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('All diagrams should be rendered. You can now download SVGs.');
            }, 2000);
        });
    </script>
</body>
</html>
